

/***************************** Include Files *******************************/
#include "hdmi_text_controller.h"
#include "stdio.h"
#include "stdlib.h"
#include "string.h"
#include "sleep.h"

/************************** Function Definitions ***************************/


void textHDMIColorClr()
{
	for (int i = 0; i<(ROWS*COLUMNS); i++)
	{
		hdmi_ctrl->VRAM[i] = 0x00;
	}
}

// void textHDMIDrawColorText(char* str, int x, int y, uint8_t background, uint8_t foreground)
// {
// 	int i = 0;
// 	while (str[i]!=0)
// 	{
// 		hdmi_ctrl->VRAM[(y*COLUMNS + x + i) * 2] = foreground << 4 | background;
// 		hdmi_ctrl->VRAM[(y*COLUMNS + x + i) * 2 + 1] = str[i];
// 		i++;
// 	}
// }



void drawPixel(int x, int y, uint8_t color)
{
	int index = (y*COLUMNS + x)/2;
	if((y*COLUMNS + x)%2 == 0) {
		hdmi_ctrl->VRAM[index] = (hdmi_ctrl->VRAM[index] & 0xF0) | (color);
	}	else {
		hdmi_ctrl->VRAM[index] = (hdmi_ctrl->VRAM[index] & 0x0F) | (color << 4);
	}

		
}

void textHDMIColorScreenSaver()
{
//	char color_string[80];
    int x, y;
	uint8_t color;
	textHDMIColorClr();
	
	for(y=0; y<ROWS; y++) {
		for(x=0; x<COLUMNS; x++) {
			color = 0x01;
			drawPixel(x,y,color);
		}
	}
	
//		fg = rand() % 16;
//		bg = rand() % 16;
//		while (fg == bg)
//		{
//			fg = rand() % 16;
//			bg = rand() % 16;
//		}
//		sprintf(color_string, "Drawing %s text with %s background", colors[fg].name, colors[bg].name);
//		x = rand() % (80-strlen(color_string));
//		y = rand() % 30;
		
//		textHDMIDrawColorText (color_string, x, y, bg, fg)
		
	}

//Call this function for your Week 2 test
hdmiTestWeek2()
{
    //On-chip memory write and readback test
	uint32_t checksum[ROWS], readsum[ROWS];

	for (int j = 0; j < ROWS; j++)
	{
		checksum[j] = 0;
		for (int i = 0; i < COLUMNS * 2; i++)
		{
			hdmi_ctrl->VRAM[j*COLUMNS*2 + i] = i + j;
			checksum[j] += i + j;
		}
	}
	
	for (int j = 0; j < ROWS; j++)
	{
		readsum[j] = 0;
		for (int i = 0; i < COLUMNS * 2; i++)
		{
			readsum[j] += hdmi_ctrl->VRAM[j*COLUMNS*2 + i];
//			xil_printf ("%x \n\r", hdmi_ctrl->VRAM[j*COLUMNS*2 + i]);
		}
//		xil_printf ("Row: %d, Checksum: %x, Read-back Checksum: %x\n\r", j, checksum[j], readsum[j]);
		if (checksum[j] != readsum[j])
		{
//			xil_printf ("Checksum mismatch!, check your AXI4 code or your on-chip memory\n\r");
			while (1){};
		}
	}
	xil_printf ("Checksum passed, beginning palette test\n\r");
	
//    textHDMIColorScreenSaver();
}

